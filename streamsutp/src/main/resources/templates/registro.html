<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>StreamsUTP - Registro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Asegurar que footer quede al fondo cuando el contenido es corto */
        html, body { height: 100%; }
    /* Fondo: usar imagen fondo.png (responsive) */
    html { background-image: url('/imagenes/fondo.png'); background-size: cover; background-position: center center; background-repeat: no-repeat; background-attachment: fixed; }
        body { display: flex; flex-direction: column; min-height: 100vh; }
        main { flex: 1 0 auto; }

    /* Fondo del body usando la misma imagen para consistencia (responsive) */
    body { background-image: url('/imagenes/fondo.png'); background-size: cover; background-position: center center; background-repeat: no-repeat; background-attachment: fixed; }

    /* Overlay para mejorar legibilidad del formulario (más sutil en registro) */
    .page-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.12); z-index: 1; }

        /* Asegurar que header/main/footer estén por encima del overlay */
        header, main, footer { position: relative; z-index: 2; }

        /* Centrar el panel dentro del container igual que ingreso.html */
        main.container { display: flex; align-items: center; justify-content: center; min-height: calc(100vh - 120px); }

    /* Wrapper centrado, altura auto para que el panel no llene toda la pantalla */
    .ingreso-wrapper { width: 100%; max-width: 920px; height: auto; display: flex; align-items: center; justify-content: center; padding: 40px 0; }

    /* Formulario más ancho y con fondo más opaco para destacar */
    .registro-form { background: rgb(0 0 0 / 90%); padding: 36px; border-radius: 10px; box-shadow: 0 18px 48px rgba(0,0,0,0.6); color: #fff; width: 100%; max-width: 640px; }
        .brand-logo img { width: 84px; height: auto; display: block; margin: 0 auto 8px auto; }
        .brand-name { color: #fff; font-size: 20px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; text-align: center; margin-bottom: 18px; }

        .registro-form .form-control { background: rgba(255,255,255,0.04) !important; color: #f1f1f1 !important; border: 1px solid rgba(255,255,255,0.06) !important; box-shadow: none !important; padding: 12px 14px !important; border-radius: 6px; }
        .registro-form .form-control::placeholder { color: rgba(241,241,241,0.6) !important; }
        .registro-form label { color: rgba(241,241,241,0.85); }

        .registro-form .btn-primary { background: linear-gradient(#e50914, #b10610) !important; border: none; font-weight: 700; padding: 12px 16px; border-radius: 6px; box-shadow: 0 6px 18px rgba(0,0,0,0.4); }

        @media (max-width: 991.98px) {
            .ingreso-wrapper { height: auto; padding: 40px 16px; }
            .registro-form { max-width: 100%; }
        }
        @media (max-width: 575.98px) { .ingreso-wrapper { padding: 12px; } .registro-form { padding: 20px; } }

        /* Mobile specific: ensure the background doesn't appear cropped and overlay slightly stronger for legibility */
        @media (max-width: 420px) {
            .page-overlay { background: rgba(0,0,0,0.18); }
        }
    </style>
</head>

<body>
<div th:replace="~{fragments/header :: navbar}"></div>
<div class="page-overlay" aria-hidden="true"></div>
<main class="container">
    <div class="ingreso-wrapper">
        <form class="registro-form" th:action="@{/registro}" method="post" th:object="${usuario}">
            <div class="brand-logo">
                <img th:src="@{/imagenes/logo.png}" alt="Logo">
            </div>
            <div class="brand-name">StreamsUTP</div>
            <h2 class="mb-4 text-center">Regístrate</h2>

            <div class="mb-3">
                <label class="form-label">Apellidos</label>
                <input type="text" th:field="*{apellidos}" class="form-control" placeholder="Ingrese sus apellidos">
                <div class="text-danger" th:if="${#fields.hasErrors('apellidos')}" th:errors="*{apellidos}"></div>
            </div>

            <div class="mb-3">
                <label class="form-label">Nombres</label>
                <input type="text" th:field="*{nombres}" class="form-control" placeholder="Ingrese sus nombres">
                <div class="text-danger" th:if="${#fields.hasErrors('nombres')}" th:errors="*{nombres}"></div>
            </div>

            <div class="mb-3">
                <label class="form-label">Usuario</label>
                <input type="text" th:field="*{username}" class="form-control" placeholder="Ingrese un nombre de usuario">
                <div class="text-danger" th:if="${#fields.hasErrors('username')}" th:errors="*{username}"></div>
                <div class="text-danger" th:if="${userExistsError}" th:text="${userExistsError}"></div>
            </div>

            <div class="mb-3">
                <label class="form-label">Contraseña</label>
                <input type="password" th:field="*{password}" class="form-control" placeholder="Ingrese su contraseña">
                <div class="text-danger" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></div>
            </div>

            <div class="mb-3">
                <label class="form-label">Repetir Contraseña</label>
                <input type="password" th:field="*{repetirPassword}" class="form-control" placeholder="Repita su contraseña">
                <div class="text-danger" th:if="${passwordMismatchError}" th:text="${passwordMismatchError}"></div>
            </div>


            <div class="mb-3">
                <label class="form-label">Correo Electrónico</label>
                <input type="email" th:field="*{email}" class="form-control" placeholder="Ingrese su correo electrónico">
                <div class="text-danger" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>
                <div class="text-danger" th:if="${emailExistsError}" th:text="${emailExistsError}"></div>
            </div>

            <input type="hidden" th:field="*{rol}" value="USER" />

            <button type="submit" class="btn btn-primary w-100">Registrarse</button>
        </form>
    </div>
</main>

<footer class="bg-dark text-white py-4">
    <div class="container text-center">
        <p class="mb-0">© 2025 StreamsUTP. Todos los derechos reservados.</p>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>